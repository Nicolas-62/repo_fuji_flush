#{extends 'main.html' /}
#{set title:'Game Room' /}

<nav class="navigation">
    <a href="@{Application.ranking()}" class="navigation-item"> Ranking </a>
    <a href="@{Application.gameRoom()}" class="navigation-item"> Game Room </a>
    <a href="/records" class="navigation-item"> Records </a>
</nav>

<div class="gameRoom">
    <div class="newGame">

        <form action="@{Application.addGame()}" method="post">
                <div class ="radio">
                    <input type="radio"
                           name="nbPlayer" value="3" checked>
                    <label>3</label>

                    <input type="radio"
                           name="nbPlayer" value="4" checked>
                    <label>4</label>

                    <input type="radio"
                           name="nbPlayer" value="5" checked>
                    <label>5</label>

                    <input type="radio"
                           name="nbPlayer" value="6" checked>
                    <label>6</label>

                    <input type="radio"
                           name="nbPlayer" value="7" checked>
                    <label>7</label>

                    <input type="radio"
                           name="nbPlayer" value="8" checked>
                    <label>8 Players</label>
                </div>
            <input type="submit" class="submitbtn" value="New Timeless Game">
        </form>
    </div>

    <div class="games">
        <div class="availablegames">
            <p>Available games :</p>
        #{if games}
            #{list items:games, as:'aGame'}
                        #{set join:true/}
                        #{list items:aGame.hands, as:'aHand'}
                            #{if aHand.player.equals(player)}
                               #{set join:false/}
                            #{/if}
                        #{/list}

                    #{if join}
                        #{if aGame.nbPlayerMissing == 0}
                            <li>${aGame.hands.size()}/${aGame.hands.size()+aGame.nbPlayerMissing} players<a class="registerbtn" href="#">Full</a></li>
                        #{/if}
                        #{else}
                            <li>${aGame.hands.size()}/${aGame.hands.size()+aGame.nbPlayerMissing} players<a class="registerbtn" href="@{Application.joinGame(aGame.id)}">Join</a></li>
                        #{/else}
                    #{/if}
            #{/list}
        #{/if}
        </div>

            <div class="mygames">
                <p>My games :</p>
                #{if games}
                #{list items:games, as:'aGame'}
                #{list items:aGame.hands, as:'aHand'}
                #{if aHand.player.equals(player)}
                    #{if aGame.nbPlayerMissing == 0}
                    <li >${aGame.hands.size()}/${aGame.hands.size()+aGame.nbPlayerMissing} players
                     #{if aHand.hasLeft}
                        <span>You have quit the Game</span>
                    #{/if}
                    #{else}
                        <a class="registerbtn" href="@{Application.play(aGame.id)}"> play </a>
                    #{/else}
                    </li>
                    #{/if}
                    #{else}
                    <li> ${aGame.hands.size()}/${aGame.hands.size()+aGame.nbPlayerMissing} players<a class="registerbtn" href="#"> Waiting </a></li>
                    #{/else}
                #{/if}
                #{/list}
            #{/list}
        #{/if}
    </div>
</div>
</div>